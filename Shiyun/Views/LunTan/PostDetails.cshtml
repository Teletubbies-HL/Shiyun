@model Shiyun.Models.LuntanIndex
@{
    ViewBag.Title = "帖子详情";
}
@section style{
    <link href="~/Content/css/PostDetails.css" rel="stylesheet" />
    <style>
    </style>

}
<div class="Tribune-choose">
    <div class="cotenter">
        <ul>
            <li><a href="/LunTan/Index" style="text-decoration: none;" class="cssButton">首页</a></li>
            @foreach (var fenlei in Model.FenLei)
            {
                <li><a class="cssButton" href="javascript:void(0)">@fenlei.LunTanName</a></li>
            }
        </ul>
    </div>
</div>
<section>
    <div class="leftbox">
        <div class="leftbox1">
            <div class="leftbox_1">
                <div class="cssdltnowluntan" id="dltnowluntan"><!--当前位置-->
                    <a href="Tribune.aspx"><span class="nowluntan">互动论坛 ></span></a>
                    <a href="javascript:void(0)" style="text-decoration: none">
                        @foreach (var ln in Model.LuntanName)
                        {
                            <span class="nowluntan2">@ln.LunTanName</span>
                        }

                    </a>
                </div>
                <div class="postdetail">
                    @foreach (var pd in Model.PostDetails)
                    {
                        <div id="ltvpostdetail">
                            <div class="userimage">
                                <img id="imgUser" class="imgcssUser" src="@pd.UserImage" style="width: 100%; height: 100%;"/>
                            </div>
                            <div class="posttitle">@pd.PostTitle</div>
                            <div class="postname">@pd.UserName</div>
                            <div class="posttime">@pd.AddTime</div>
                            <div class="postcontent">@Html.Raw(pd.PostDetails)</div>
                            <audio controls="controls" class="music" style="display: block;">
                            <source src="@pd.Mp3_Url" type="audio/mpeg"/>
                            </audio>
                            <input type="hidden" class="mp3url" value="@pd.Mp3_Url" />
                            <input type="hidden" class="postid" value="@pd.Post_id"/>
                            <input type="hidden" class="luntanid" value="@pd.LunTan_id"/>
                            <input type="hidden" class="userid" value="@pd.Users_id" />
                        </div>
                    }
                    <input id="btnpinglun" class="csspinglun" value="评论" readonly="readonly" type="submit"/>
                    <input id="btndelete" class="cssShanchu" value="删除" readonly="readonly" style="display: none"/>
                    <input type="hidden" class="Hidden1" id="hfdpinglun" value=""/>
                    <hr style="border-bottom: 1px solid #E6E6E6; display: block; float: right; margin: 25px 0px 0px; width: 100%;"/>

                </div>
                <div id="getAllPostReply">
                    @{Html.RenderAction("GetAllPostReply", "LunTan");}
                </div>
            </div>
        </div>
        <lable id="PLhidden" style="display: none;"></lable>
        @using (Ajax.BeginForm("Pinglun", "LunTan", new AjaxOptions {HttpMethod = "post", UpdateTargetId = "PLhidden"}))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true, "", new {@class = "text-danger"})
            <div class="huifu">
                <div class="huifu_1">
                    @Html.HiddenFor(model => model.PostReply.Post_id, new {@Value = @ViewBag.Post_id})
                    @Html.HiddenFor(model => model.PostReply.ReReply_id, new {@Value = "", @class = "rereid"})
                    <div class="Main">
                        @Html.TextAreaFor(model => model.PostReply.ReplyContent, htmlAttributes: new {@class = "ckeditor form-control Input_text con", id = "TextBox1", style = "width: 100%; height: 100px;"})
                        @Html.ValidationMessageFor(model => model.PostReply.ReplyContent, "", new {@class = "text-danger"})
                        <input value="确定" class="queding" type="submit"/>

                        @*<div class="Input_Box">
                        <textarea id="TextBox1" class="Input_text"></textarea>
                        <div class="faceDiv"> </div>
                        <div class="Input_Foot">
                            <a class="imgBtn" href="javascript:void(0);"></a>
                            <input id="btnsubmit " value="确定" class="postBtn"/>
                        </div>
                    </div>*@
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="rightbox">
        <div class="tuijian">
            <span style="width: 100%; display: block; font-size: 17px; color: rgb(221, 59, 68); padding-bottom: 15px; border-bottom: 1px solid #E6E6E6;">推荐阅读</span>
            <div id="ltvtuijian">

                <div>
                    <a class="tuijiantitle" href='javascript:void(0)' style="text-decoration: none; color: #515151; line-height: 44px;">
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
@section scripts{
<script src="~/Scripts/ckeditor-face/ckeditor.js"></script>
<script src="~/Scripts/ckeditor-face/config.js"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script type="text/javascript">
        //$(function() {
        //    var isShowImg = false;
        //    $(document).ready(function (e) {
        //        ImgIputHandler.Init();
        //    });
        //    var ImgIputHandler = {
        //        facePath: [
        //            { faceName: "微笑", facePath: "0_微笑.gif" },
        //	        { faceName: "撇嘴", facePath: "1_撇嘴.gif" },
        //	        { faceName: "色", facePath: "2_色.gif" },
        //	        { faceName: "发呆", facePath: "3_发呆.gif" },
        //	        { faceName: "得意", facePath: "4_得意.gif" },
        //	        { faceName: "流泪", facePath: "5_流泪.gif" },
        //	        { faceName: "害羞", facePath: "6_害羞.gif" },
        //	        { faceName: "闭嘴", facePath: "7_闭嘴.gif" },
        //	        { faceName: "大哭", facePath: "9_大哭.gif" },
        //	        { faceName: "尴尬", facePath: "10_尴尬.gif" },
        //	        { faceName: "发怒", facePath: "11_发怒.gif" },
        //	        { faceName: "调皮", facePath: "12_调皮.gif" },
        //	        { faceName: "龇牙", facePath: "13_龇牙.gif" },
        //	        { faceName: "惊讶", facePath: "14_惊讶.gif" },
        //	        { faceName: "难过", facePath: "15_难过.gif" },
        //	        { faceName: "酷", facePath: "16_酷.gif" },
        //	        { faceName: "冷汗", facePath: "17_冷汗.gif" },
        //	        { faceName: "抓狂", facePath: "18_抓狂.gif" },
        //	        { faceName: "吐", facePath: "19_吐.gif" },
        //	        { faceName: "偷笑", facePath: "20_偷笑.gif" },
        //            { faceName: "可爱", facePath: "21_可爱.gif" },
        //	        { faceName: "白眼", facePath: "22_白眼.gif" },
        //	        { faceName: "傲慢", facePath: "23_傲慢.gif" },
        //	        { faceName: "饥饿", facePath: "24_饥饿.gif" },
        //	        { faceName: "困", facePath: "25_困.gif" },
        //	        { faceName: "惊恐", facePath: "26_惊恐.gif" },
        //	        { faceName: "流汗", facePath: "27_流汗.gif" },
        //	        { faceName: "憨笑", facePath: "28_憨笑.gif" },
        //	        { faceName: "大兵", facePath: "29_大兵.gif" },
        //	        { faceName: "奋斗", facePath: "30_奋斗.gif" },
        //	        { faceName: "咒骂", facePath: "31_咒骂.gif" },
        //	        { faceName: "疑问", facePath: "32_疑问.gif" },
        //	        { faceName: "嘘", facePath: "33_嘘.gif" },
        //	        { faceName: "晕", facePath: "34_晕.gif" },
        //	        { faceName: "折磨", facePath: "35_折磨.gif" },
        //	        { faceName: "衰", facePath: "36_衰.gif" },
        //	        { faceName: "骷髅", facePath: "37_骷髅.gif" },
        //	        { faceName: "敲打", facePath: "38_敲打.gif" },
        //	        { faceName: "再见", facePath: "39_再见.gif" },
        //	        { faceName: "擦汗", facePath: "40_擦汗.gif" },
        //	        { faceName: "抠鼻", facePath: "41_抠鼻.gif" },
        //	        { faceName: "鼓掌", facePath: "42_鼓掌.gif" },
        //	        { faceName: "糗大了", facePath: "43_糗大了.gif" },
        //	        { faceName: "坏笑", facePath: "44_坏笑.gif" },
        //	        { faceName: "左哼哼", facePath: "45_左哼哼.gif" },
        //	        { faceName: "右哼哼", facePath: "46_右哼哼.gif" },
        //	        { faceName: "哈欠", facePath: "47_哈欠.gif" },
        //	        { faceName: "鄙视", facePath: "48_鄙视.gif" },
        //	        { faceName: "委屈", facePath: "49_委屈.gif" },
        //	        { faceName: "快哭了", facePath: "50_快哭了.gif" },
        //	        { faceName: "阴险", facePath: "51_阴险.gif" },
        //	        { faceName: "亲亲", facePath: "52_亲亲.gif" },
        //	        { faceName: "吓", facePath: "53_吓.gif" },
        //	        { faceName: "可怜", facePath: "54_可怜.gif" },
        //	        { faceName: "菜刀", facePath: "55_菜刀.gif" },
        //	        { faceName: "西瓜", facePath: "56_西瓜.gif" },
        //	        { faceName: "啤酒", facePath: "57_啤酒.gif" },
        //	        { faceName: "篮球", facePath: "58_篮球.gif" },
        //	        { faceName: "乒乓", facePath: "59_乒乓.gif" },
        //	        { faceName: "拥抱", facePath: "78_拥抱.gif" },
        //	        { faceName: "握手", facePath: "81_握手.gif" },
        //	        { faceName: "得意地笑", facePath: "得意地笑.gif" },
        //	        { faceName: "听音乐", facePath: "听音乐.gif" }
        //        ],
        //        Init: function () {
        //            $(".Input_text").focusout(function () {
        //                $(this).parent().css("border-color", "#cccccc");
        //                $(this).parent().css("box-shadow", "none");
        //                $(this).parent().css("-moz-box-shadow", "none");
        //                $(this).parent().css("-webkit-box-shadow", "none");
        //            });
        //            $(".Input_text").focus(function () {
        //                $(this).parent().css("border-color", "rgba(19,105,172,.75)");
        //                $(this).parent().css("box-shadow", "0 0 3px rgba(19,105,192,.5)");
        //                $(this).parent().css("-moz-box-shadow", "0 0 3px rgba(241,39,232,.5)");
        //                $(this).parent().css("-webkit-box-shadow", "0 0 3px rgba(19,105,252,3)");
        //            });
        //            $(".postBtn").click(function () {
        //                //alert($(".Input_text").val());
        //            });
        //        },
        //        insertAtCursor: function (myField, myValue) {
        //            if (document.selection) {
        //                myField.focus();
        //                sel = document.selection.createRange();
        //                sel.text = myValue;
        //                sel.select();
        //            } else if (myField.selectionStart || myField.selectionStart == "0") {
        //                var startPos = myField.selectionStart;
        //                var endPos = myField.selectionEnd;
        //                var restoreTop = myField.scrollTop;
        //                myField.value = myField.value.substring(0, startPos) + myValue + myField.value.substring(endPos, myField.value.length);
        //                if (restoreTop > 0) {
        //                    myField.scrollTop = restoreTop;
        //                }
        //                myField.focus();
        //                myField.selectionStart = startPos + myValue.length;
        //                myField.selectionEnd = startPos + myValue.length;
        //            } else {
        //                myField.value += myValue;
        //                myField.focus();
        //            }
        //        }
        //    }
        //    $(".imgBtn").click(function () {
        //        if (isShowImg == false) {
        //            isShowImg = true;
        //            $(this).parent().prev().animate({ marginTop: "-125px" }, 300);
        //            if ($(".faceDiv").children().length == 0) {
        //                for (var i = 0; i < ImgIputHandler.facePath.length; i++) {
        //                    $(".faceDiv").append("<img title=\"" + ImgIputHandler.facePath[i].faceName + "\" src=\"/images/face/" + ImgIputHandler.facePath[i].facePath + "\" />");
        //                }
        //                $(".faceDiv img").click(function () {
        //                    isShowImg = false;
        //                    $(this).parent().animate({ marginTop: "0px" }, 300);
        //                    ImgIputHandler.insertAtCursor($(".Input_text")[0], "[afgimg src=" + '"' + $(this).attr("src") + '"' + "bfg]");
        //                });
        //            }
        //        } else {
        //            isShowImg = false;
        //            $(this).parent().prev().animate({ marginTop: "0px" }, 300);
        //        }
        //    });
        //});  
        $(function() {
            $(".Tribune-choose .cotenter ul").children(":eq(1)").children().click(function() {
                $.ajax({
                    type: "post",
                    url: "/LunTan/GetAllPost",
                    data: { luntanId: 1 },
                    success: function(data) {
                        location.href = "/LunTan/YuanChuang?luntanId=1";                        
                    }
                });
            });
            $(".Tribune-choose .cotenter ul").children(":eq(2)").children().click(function() {
                $.ajax({
                    type: "post",
                    url: "/LunTan/GetAllPost",
                    data: { luntanId: 2 },
                    success: function(data) {
                        location.href = "/LunTan/YuanChuang?luntanId=2";
                    }
                });
            });
            $(".Tribune-choose .cotenter ul").children(":eq(3)").children().click(function() {
                $.ajax({
                    type: "post",
                    url: "/LunTan/GetAllPost",
                    data: { luntanId: 3 },
                    success: function(data) {
                        location.href = "/LunTan/YuanChuang?luntanId=3";
                    }
                });
            });
        });
        $(function() {
            $(".csspinglun").click(function () {  //点击评论
                //给rereply改变值
                var b = "";
                $(".Hidden1").val(null);
                var re = $(".Hidden1").val();
                $(".rereid").val(re);
                alert($(".rereid").val())
                //跳转到底部
                var webheight = document.body.scrollHeight; //网页高度
                $('body,html').animate({ scrollTop: webheight - 1150 }, 1000);
                $('body,html').off("mousewheel", preventScroll); //去除scrollTop=0对滚动的限制             
            });
            $(document).on('click', '.cssbtnReply', function () {
                //给rereply改变值
                var replyid = $(this).next().val();
                $(".Hidden1").val(replyid);
                var re = $(".Hidden1").val();
                $(".rereid").val(re);
                alert($(".rereid").val());
                //跳转到底部        
                var webheight = document.body.scrollHeight; //网页高度
                $('body,html').animate({ scrollTop: webheight - 1150 }, 1000);
                $('body,html').off("mousewheel", preventScroll); //去除scrollTop=0对滚动的限制
            });
            //$(".cssbtnReply").click(function () {  //点击回复
            //    //给rereply改变值
            //    var replyid = $(this).next().val();
            //    $(".Hidden1").val(replyid);
            //    var re = $(".Hidden1").val();
            //    $(".rereid").val(re);
            //    alert($(".rereid").val());
            //    //跳转到底部        
            //    var webheight = document.body.scrollHeight; //网页高度
            //    $('body,html').animate({ scrollTop: webheight - 1150 }, 1000);
            //    $('body,html').off("mousewheel", preventScroll); //去除scrollTop=0对滚动的限制
            //});
            //$(".cssbtnReply").unbind("click");
            $(".queding").click(function () {     //提交评论                   
                //var time = setInterval 
                //clearInterval(time);     
                setTimeout(function () {
                    var plHidden = $("#PLhidden").text();
                    if (plHidden == "aa") {
                        $.ajax({
                            type: "post",
                            url: "/LunTan/GetAllPostReply",
                            data: { postId: $(".postid").val(), luntanId: $(".luntanid").val() },
                            success: function (data) {
                                $("#getAllPostReply").html(data);
                                //回到顶部
                                $('body,html').animate({ scrollTop: 200 }, 1000);
                                $('body,html').off("mousewheel", preventScroll); //去除scrollTop=0对滚动的限制
                            }
                        });
                    } else {
                    }

                }, 1000);

            });
            //显示删除按钮
            var uid = $(".userid").val();
            if (uid =="@Session["Users_id"]") {
                $(".cssShanchu").css("display", "block");
            } else {
                $(".cssShanchu").css("display", "none");
            }
            $(".cssShanchu").click(function () {  //删除
                $.ajax({
                    type: "post",
                    url: "/LunTan/ShanChu",
                    data: { postId: $(".postid").val() },
                    success: function (data) {
                        if (data == "aa") {
                            confirm("确定删除吗？");
                            var luntanid = $(".luntanid").val();
                            location.href = "/LunTan/YuanChuang?luntanId=" + luntanid;
                        } else {    
                        }
                      
                    }
                });
            });
            //显示MP3区域
            if ($(".mp3url").val().length > 33) {
                $(".music").css("display", "block");
            } else {
                $(".music").css("display", "none");
            }


        });
    </script>

}
